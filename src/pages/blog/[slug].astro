---
import Layout from '../../layouts/Layout.astro';
import fs from 'fs';
import path from 'path';
import { marked } from 'marked';

const { slug } = Astro.params;
const filePath = new URL(`../../../content/blog/${slug}.md`, import.meta.url);
const markdownContent = await fs.promises.readFile(filePath, 'utf-8');
const renderedHTML = marked(markdownContent);

// Extract frontmatter (simple regex)
const match = markdownContent.match(/---\n([\s\S]*?)\n---/);
const frontmatterRaw = match ? match[1] : '';

// Helper to extract fields from frontmatter
const extract = (field) => {
  const reg = new RegExp(`${field}:\\s*["']?(.+?)["']?\\n`);
  const res = frontmatterRaw.match(reg);
  return res ? res[1] : '';
};

const title = extract("title") || 'Untitled Post';
const description = extract("description") || '';
const datePublished = extract("pubDate") || '';
const image = extract("image") || '';
const url = `https://www.aitoolsfordevs.in/blog/${slug}`;

const blogJsonLD = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": title,
  "description": description,
  "datePublished": datePublished,
  "author": {
    "@type": "Person",
    "name": "aitoolsfordevs Team"
  },
  "publisher": {
    "@type": "Organization",
    "name": "aitoolsfordevs",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.aitoolsfordevs.in/logo.png"
    }
  },
  "image": image,
  "url": url
};
---

<Layout title={title} description={description} image={image} url={url}>
  <head>
    <script type="application/ld+json" set:html={JSON.stringify(blogJsonLD)} />
  </head>

  <article class="prose lg:prose-xl max-w-4xl mx-auto bg-white p-8 rounded shadow">
    <div set:html={renderedHTML} />
  </article>
</Layout>
